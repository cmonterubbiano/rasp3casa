<?php 
	require_once("./login.php");

	require_once("./global_var.php");
	require_once("./function_library.php");
	require_once("./mysql_library.php");
?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title><?php echo TITLE_OF_PROJECT; ?> - MENU</title>
<link href="css/style.css" rel="stylesheet" type="text/css" />
<link href="css/iphone-style-checkboxes.css" rel="stylesheet" type="text/css" />
<link href="css/start/jquery-ui-1.10.0.custom.min.css" rel="stylesheet" type="text/css" />

<link href="css/jquery.ui.slidespinner.css" rel="stylesheet" type="text/css" />
  
</head>

<body>

<div class="container">
  <div class="header_mini">
  	
  	<a href="./index.php" class="main_menu_link"><?php echo TITLE_OF_PROJECT; ?> - MAIN MENU</a> 
    <!-- end .header --></div>
 
<?php 	require_once("./top_menu.php");  ?>    
<script src="js/iphone-style-checkboxes.js" type="text/javascript" charset="utf-8"></script>
<script src="js/jquery-ui-1.10.0.custom.min.js" type="text/javascript" charset="utf-8"></script>
<script src="js/jquery-ui-timepicker-addon.js" type="text/javascript" charset="utf-8"></script>
<script src="js/jquery.ui.slidespinner.js" type="text/javascript" charset="utf-8"></script>


  <script type="text/javascript" charset="utf-8">
    <!-- $(window).load(function() { -->
    	<!-- $('.content :checkbox').iphoneStyle(); -->
		
		<!-- $('#new_job_data_esecuzione').datepicker( {dateFormat: "dd/mm/yy"} ); -->
		<!-- $('#new_job_ora_inizio').timepicker(); -->
		<!-- $('#new_job_ora_fine').timepicker(); -->
		
		<!-- $('#new_job_durata').slidespinner({ alignment: 'horizontal', max: 300, step: 10 }); -->
		<!-- $('#new_job_consumo').slidespinner({ alignment: 'horizontal', max: 3000, step: 100 }); -->
		<!-- /*$('#new_job_durata').spinner();*/ -->
    <!-- }); -->
	
	
  </script>
  
 
    
  <div class="content">
  
  <form method="post" onsubmit="return checkFormFields();">
  		<table class="input_table">
        <tbody>
        	<tr><td class="first_column">
		        <label for="nome_job" class="new_job_text_label">Nome del Job</label>
            </td><td class="second_column">
            	<input type="text" name="nome_job" class="new_job_text" id="new_job_nome_job" value="" />
            </td></tr>
            
        	<tr><td class="first_column">
		        <label for="tipologia" class="new_job_text_label">Tipologia di Job</label>
            </td><td class="second_column">
                <select name="tipologia" class="new_job_select" id="new_job_tipologia">
                    <option value="Nessuna">Nessuna</option>
                    <?php
						foreach($fetchedArray as $row){
							echo '<option value="'. $row->nome_tipologia .'">'. $row->nome_tipologia .'</option>';
						}
					?>
                </select>
            </td></tr>
            
        	<tr><td class="first_column">
		        <label for="cadenza" class="new_job_text_label_secondary">Cadenza del Job</label>
            </td><td class="second_column">
                <select name="cadenza" class="new_job_select_grey" id="new_job_cadenza">
                    <option value="Evento_Singolo">Evento Singolo</option>
                    <option value="Giornaliero">Giornaliero</option>
                    <option value="Settimanale">Settimanale</option>
                    <option value="Mensile">Mensile</option>
                </select>
            </td></tr>
            
        	<tr><td class="first_column">
		        <label for="autoconsumo" class="new_job_text_label_secondary">Autoconsumo</label>
            </td><td class="second_column">
            	<input type="checkbox" name="autoconsumo" class="new_job_chebox" id="new_job_autoconsumo" checked="checked" />
            </td></tr>
            
        	<tr><td class="first_column">
		        <label for="durata" class="new_job_text_label_secondary">Durata</label>
            </td><td class="second_column" id="td_new_job_durata">
            	<input value="0" type="text" name="durata" class="new_job_text_grey new_job_text_grey_small" id="new_job_durata" />
                <span class="new_job_text_label_secondary" >minuti</span>
            </td></tr>
            
        	<tr><td class="first_column">
		        <label for="priorita" class="new_job_text_label_secondary">Priorità</label>
            </td><td class="second_column">
                <select name="priorita" class="new_job_select_grey" id="new_job_priorita">
                    <option value="Massima">Massima</option>
                    <option value="Alta">Alta</option>
                    <option selected="selected" value="Media">Media</option>
                    <option value="Bassa">Bassa</option>
                </select>
            </td></tr>
            
        	<tr><td class="first_column">
		        <label for="data_esecuzione" class="new_job_text_label_secondary">Data di esecuzione</label>
            </td><td class="second_column">
            	<input value="<?php echo date("d/m/Y");?>" type="text" name="data_esecuzione" class="new_job_text_grey" id="new_job_data_esecuzione" />
            </td></tr>
            
        	<tr><td class="first_column">
		        <label for="ora_inizio" class="new_job_text_label_secondary">Orario di inizio</label>
            </td><td class="second_column">
            	<input value="<?php echo date("H:i");?>" type="text" name="ora_inizio" class="new_job_text_grey" id="new_job_ora_inizio" />
            </td></tr>
            
        	<tr><td class="first_column">
		        <label for="ora_fine" class="new_job_text_label_secondary">Orario di fine</label>
            </td><td class="second_column">
            	<input type="text" name="ora_fine" class="new_job_text_grey" id="new_job_ora_fine" placeholder="automatica" />
            </td></tr>
            
        	<tr><td class="first_column">
		        <label for="consumo" class="new_job_text_label_secondary">Consumo stimato</label>
            </td><td class="second_column">
            	<input value="0" type="text" name="consumo" class="new_job_text_grey new_job_text_grey_small" id="new_job_consumo" />
                <span class="new_job_text_label_secondary" >watt</span>
            </td></tr>
            
        	<tr><td class="first_column">
		        <label for="canale_rele" class="new_job_text_label_secondary">Canale/Interruttore</label>
            </td><td class="second_column">
                <select name="canale_rele" class="new_job_select_grey" id="new_job_canale">
                    <option value="canale_1">Canale 1</option>
                    <option value="canale_2">Canale 2</option>
                    <option value="canale_3">Canale 3</option>
                    <option value="canale_4">Canale 4</option>
                </select>
            </td></tr>
            
        	<tr><td class="first_column">
		        <label for="obbligatorieta" class="new_job_text_label_secondary">Esecuzione obblig.</label>
            </td><td class="second_column">
            	<input type="checkbox" name="obbligatorieta" class="new_job_chebox" id="new_job_obbligatorieta" />
            </td></tr>
            
        	<tr><td class="first_column">
		        <label for="interrompibile" class="new_job_text_label_secondary">interrompibile</label>
            </td><td class="second_column">
            	<input type="checkbox" name="interrompibile" class="new_job_chebox" id="new_job_interrompibile" checked="checked" />
            </td></tr>
            
        	<tr><td class="first_column full_line_td" colspan="2">
            	<input type="submit" value="AGGIUNGI QUESTO JOB" class="new_job_submit" />
            </td></tr>
            
                
  		</tbody>
  		</table>
  </form>
  
   		
        
   
   		<div class="clearfloat" ></div>
    <!-- end .content --></div>
<?php 	
	} // FINE FORM INSERIMENTO
	require_once("./footer.php");  ?>    
</body>
</html>




<style>
.input_table {	width:100%; padding-top:20px; }
.input_table td {
	padding:10px;
	
}

.first_column {
	width:50%;
	text-align:right;
}

.second_column {
	width:50%;
	vertical-align:central;
}

.new_job_text_label {
	color: #8f985c;
    font-family: Arial,Helvetica,sans-serif;
    font-size: 35px;
    font-weight: 700;
    text-align: center;	
}

.new_job_text {
	color: #98022d;
    font-family: Arial,Helvetica,sans-serif;
    font-size: 35px;
    font-weight: 700;
}

.new_job_text_grey {
	color: #666;
    font-family: Arial,Helvetica,sans-serif;
    font-size: 35px;
    font-weight: 700;
}

.new_job_text_grey_small {
	width:50%;
	
}

.new_job_select {
	color: #98022d;
    font-family: Arial,Helvetica,sans-serif;
    font-size: 35px;
    font-weight: 700;
	width:100%;
}

.new_job_select_grey {
	color:#666;
    font-family: Arial,Helvetica,sans-serif;
    font-size: 35px;
    font-weight: 700;
	width:100%;
}

.new_job_text_label_secondary {
	color: #AAAAAA;
    font-family: Arial,Helvetica,sans-serif;
    font-size: 35px;
    font-weight: 700;
    text-align: center;	
}

.new_job_chebox {
	width:30px;
	height:30px;
	
}

.new_job_submit {
	color: #006600;
    border-radius: 15px 15px 15px 15px;
    border-width: 5px;
    cursor: pointer;
    font-family: Arial,Helvetica,sans-serif;
    font-size: 24px;
    font-weight: bold;
    height: 100px;
    margin: auto;
    width: 600px;
}

.new_job_submit:hover { color:#00FF00;}
.full_line_td {text-align:center}

#new_job_durata { width:220px; }
#new_job_consumo { width:220px; }

.ui-slidespinner .ui-slider .ui-slider-handle {	height: 2em; width: 2em; z-index:1; }
.ui-slidespinner {	margin-bottom:20px; }
.ui-widget input {	font-size:1.8em; }

.ui-spinner-button { width:30px; }
.ui-spinner .ui-icon { left:8px; }

.ui-timepicker-div .ui-widget-header { margin-bottom: 8px; }
.ui-timepicker-div dl { text-align: left; }
.ui-timepicker-div dl dt { height: 25px; margin-bottom: -25px; }
.ui-timepicker-div dl dd { margin: 0 10px 10px 65px; }
.ui-timepicker-div td { font-size: 90%; }
.ui-tpicker-grid-label { background: none; border: none; margin: 0; padding: 0; }

.ui-timepicker-rtl{ direction: rtl; }
.ui-timepicker-rtl dl { text-align: right; }
.ui-timepicker-rtl dl dd { margin: 0 65px 10px 10px; }



</style>



<script type="text/javascript">

function checkFormFields(){
	var nomeJob = $("#new_job_nome_job").val();
	var durata = $("#new_job_durata").val();
	var dataEsecuzione = $("#new_job_data_esecuzione").val();
	var oraInizio = $("#new_job_ora_inizio").val();
	var oraFine = $("#new_job_ora_fine").val();
	var consumoStimato = $("#new_job_consumo").val();
	
	if(nomeJob == ""){
		alert("Inserire un NOME per questo JOB");
		return(false);	
	}
	
	if(durata == ""){
		alert("Inserire un valore per la DURATA");
		return(false);	
	}
	
	if(isNaN(durata)){
		alert("Inserire un valore NUMERICO per la DURATA");
		return(false);	
	}

	if(durata == "0"){
		var confirmBox=confirm("Attenzione, DURATA pari a ZERO. Significa che il JOB avrà tempo infinito come ad esempio il condizionamento o il riscaldamento e si fermerà in base ad altri parametri. Si vuole procedere comunque all'inserimento di questa Tipologia?");
		if(!(confirmBox)){return(false);}
	}
		
	if(dataEsecuzione == ""){
		alert("Inserire un valore per la DATA ESECUZIONE");
		return(false);	
	}
	
	if(!(isValidDate(dataEsecuzione,"dd/mm/yy"))){
		alert("Inserire una DATA VALIDA in formato DD/MM/YYYY per la DATA ESECUZIONE");
		return(false);	
	}
		
	if(oraInizio == ""){
		alert("Inserire un valore per ORA INIZIO");
		return(false);	
	}
		
	if(!(isValidTime(oraInizio,"hh:mm"))){
		alert("Inserire un'ORA VALIDA in formato HH:MM per ORA INIZIO");
		return(false);	
	}
		
	if((!(isValidTime(oraFine,"hh:mm"))) && (oraFine != "")){
		alert("Inserire un'ORA VALIDA in formato HH:MM per ORA FINE o lasciare vuoto il campo");
		return(false);	
	}
		
	if(isNaN(consumoStimato)){
		alert("Inserire un valore NUMERICO per il CONSUMO STIMATO");
		return(false);	
	}
	
	if(consumoStimato == "0"){
		//alert("Inserito un CONSUMO STIMATO pari a ZERO. Inutile aggiungere questo tipo di Job");
		var confirmBox=confirm("Attenzione, CONSUMO STIMATO pari a ZERO. Si vuole procedere comunque all'inserimento di questo JOB?");
		if(!(confirmBox)){return(false);}
	}
	
	return(true);	
}



function isValidDate(dateToCheck, format){
    var isValid = true;
    try{         jQuery.datepicker.parseDate(format, dateToCheck);    }
    catch(error){        isValid = false;    }
    return isValid;
}

function isValidTime(timeToCheck){
    var isValid = true;
	if(timeToCheck.length != 5 ){ return(false); }
	var hour = timeToCheck.substr(0,2);
	var minutes = timeToCheck.substr(3,5);
	if(isNaN(hour)){ return(false); }
	if(isNaN(minutes)){ return(false); }
	if(Number(hour) > 23){ return(false); }
	if(Number(minutes) > 59){ return(false); }
    return isValid;
}




var jsonEndodedArrayOfTipologies = <?php echo $jsonEndodedArrayOfTipologies; ?>;

//alert("jsonEndodedArrayOfTipologies: " + jsonEndodedArrayOfTipologies[0]["nome_tipologia"]);

jQuery("#new_job_tipologia").change(function () {
	jQuery("#new_job_tipologia option:selected").each(function () {
		upDateFormWithDataFromTipology( jQuery(this).val() );
	});
}).change();

function upDateFormWithDataFromTipology( idOfSelectedTypology ){
	//alert("selected: " + idOfSelectedTypology);
	var selectedTipologyData;
	if(idOfSelectedTypology == "Nessuna"){ resetAllFormField(); }
	else {
		for(index in jsonEndodedArrayOfTipologies){
			if(jsonEndodedArrayOfTipologies[index]["nome_tipologia"] == idOfSelectedTypology){ 
				selectedTipologyData = jsonEndodedArrayOfTipologies[index];
			}			
		}

		//alert(selectedTipologyData["nome_tipologia"]);
		//console.log("selectedTipologyDataDurata: " + selectedTipologyData["durata"]);
		
		//autoconsumo
		if(selectedTipologyData["autoconsumo"] == "1"){	jQuery("#new_job_autoconsumo").attr('checked', true);} 
		else { jQuery("#new_job_autoconsumo").attr('checked', false); }
		jQuery("#new_job_autoconsumo").iphoneStyle("refresh");
		
		//durata
		jQuery("#new_job_durata").val(selectedTipologyData["durata"] );
		
		//priorita
		$("#new_job_priorita").val(selectedTipologyData["priorita"] );
		
		//ora_inizio
		$("#new_job_ora_inizio").val( (selectedTipologyData["ora_inizio"]).substring(0,5) );
		
		//ora_fine
		if( selectedTipologyData["ora_fine"] != null){ $("#new_job_ora_fine").val( (selectedTipologyData["ora_fine"]).substring(0,5) );		} else { $("#new_job_ora_fine").val("");	}

		//consumo
		jQuery("#new_job_consumo").val(selectedTipologyData["consumo"] );
		
		//canale_rele
		jQuery("#new_job_canale").val(selectedTipologyData["canale_rele"] );
		
		//interrompibile
		if(selectedTipologyData["interrompibile"] == "1"){	jQuery("#new_job_interrompibile").attr('checked', true);} 
		else { jQuery("#new_job_interrompibile").attr('checked', false); }
		jQuery("#new_job_interrompibile").iphoneStyle("refresh");
	
		
	}
}

function resetAllFormField(){
	//alert("reset values");
	
	//autoconsumo
	jQuery("#new_job_autoconsumo").attr('checked', true);
	jQuery("#new_job_autoconsumo").iphoneStyle("refresh");
	
	//durata
	jQuery("#new_job_durata").val("0");
	
	//priorita
	$("#new_job_priorita").val("Media");

	//ora_inizio
	var oraInizio = 
	$("#new_job_ora_inizio").val( "00:00" );
	
	//ora_fine
	$("#new_job_ora_fine").val("");

	//consumo
	jQuery("#new_job_consumo").val("0");

	//canale_rele
	jQuery("#new_job_canale").val("canale_1");

	//interrompibile
	jQuery("#new_job_interrompibile").attr('checked', true);
	jQuery("#new_job_interrompibile").iphoneStyle("refresh");
	
}


</script>